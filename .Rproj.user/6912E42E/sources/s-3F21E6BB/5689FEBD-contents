setwd("C:/Users/epassero/Desktop/VRDSS/FFA")

# Load required packages
packages <- c("lmomco","scales")
#  Check to see if each is installed, and install if not.
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {    
  install.packages(setdiff(packages, rownames(installed.packages())))  
}
# load the installed libraries in the packages list 
lapply(packages,library,character.only=TRUE)


# Pull data directly from USGS gage
mysite<-'08263500'
parameterCd <- "00060"
startDate <- "1990-10-01"
endDate <- "2019-08-28"
dailypeak<-readNWISpeak(mysite,startDate,endDate)

# calculate exceedence probability
hydroEP <- data.frame(discharge = dailypeak$peak_va,rank=rank(-dailypeak$peak_va,ties.method = "min"))
n <- as.numeric(length(hydroEP$discharge))
hydroEP <- hydroEP %>%
  mutate(EP = hydroEP$rank/(1+n),nonEP = (1-EP)) %>%
  select(nonEP)

# assign parameters
series <- dailypeak$peak_va
distribution <- 'lp3'
nep <- as.numeric(hydroEP$nonEP)

# load functions
source("FrequencyAnalysis.R")
source("BootstrapCI.R")
source("FrequencyPlot.R")


# Run functions
bsList <- BootstrapCI(series,distribution,1000,nep,ci=0.95)
ci <- bsList[[1]] # extract df of confidence interval
plt <- frequencyPlot(series,ci,mysite)
plt
