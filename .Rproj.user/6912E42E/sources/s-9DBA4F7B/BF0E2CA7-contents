# The function generates plots of total available and effective habitat area and discharge through the hydrograph
# Last updated by Elaina Passero on 11/15/19

interp.plot <- function(inter_tab,NormalizeByL){
  
  # one data frame for all lifestages
  if(length(lifestages) > 1){
    i_tab_all_age <- bind_rows(inter_tab,.id = "lifestage") %>%
      pivot_longer()
  } else{
    i_tab_all_age <-inter_tab[[1]] %>%
      mutate(lifestage = lifestages[[1]])
  }
  
  # create longer df
  i_tab_all_age <- i_tab_all_age %>%
    pivot_longer(c(discharge,total_area),names_to = "metric")
  
  met.labs <- c("Discharge","Total Habitat Area")
  names(met.labs) <- c("discharge","total_area")
  
  p_tot <- ggplot(i_tab_all_age)+
    geom_line(data = filter(i_tab_all_age,metric=="discharge"),aes(x=date,y=value),size=1)+
    geom_line(data = filter(i_tab_all_age,metric=="total_area"),aes(x=date,y=value,linetype=lifestage))+
    theme_gray()+
    theme(text=element_text(size=14,face = "bold",color = "black"),
          panel.border = element_rect(fill = NA,size=1),
          strip.background = element_rect(fill = NA),
          axis.text.x = element_text(colour = "black",face="plain"),
          axis.text.y = element_text(colour = "black",face="plain"))+
    facet_wrap(~metric)+
    facet_grid(rows = vars(metric),labeller = labeller(metric = met.labs))+
    ggplot2::ylim(0,max(modeled_q))+
    labs(x="Date",y=NULL)
  
  if(NormalizeByL=="Yes"){
    # create longer df
    i_tab_all_age <- i_tab_all_age %>%
      pivot_longer(c(discharge,normalized_area),names_to = "metric")
    
    met.labs <- c("Discharge","Normalized Habitat Area")
    names(met.labs) <- c("discharge","normalized_area")
    
    p_norm <- ggplot(i_tab_all_age)+
      geom_line(data = filter(i_tab_all_age,metric=="discharge"),aes(x=date,y=value),size=1)+
      geom_line(data = filter(i_tab_all_age,metric=="normalized_area"),aes(x=date,y=value,linetype=lifestage))+
      theme_gray()+
      theme(text=element_text(size=14,face = "bold",color = "black"),
            panel.border = element_rect(fill = NA,size=1),
            strip.background = element_rect(fill = NA),
            axis.text.x = element_text(colour = "black",face="plain"),
            axis.text.y = element_text(colour = "black",face="plain"))+
      facet_wrap(~metric)+
      facet_grid(rows = vars(metric),labeller = labeller(metric = met.labs))+
      ggplot2::ylim(0,max(modeled_q))+
      labs(x="Date",y=NULL)
    plot_list <- list(p_tot,p_norm)
  } else{plot_list <- list(p_tot)}
  return(plot_list)
}

